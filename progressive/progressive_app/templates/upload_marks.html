{% extends 'base.html' %}
{% block title %}{{ form_title }}{% endblock %}
{% block content %}
<div class="container">
  <h3><i class="bi bi-pencil-square"></i> {{ form_title }}</h3>

  <!-- Step 1: Select Class + Subject + Semester -->
  <form method="post" class="mb-4">
      {% csrf_token %}
    <div class="row mb-3">
      <div class="col-md-4">
        <label for="school_class">Class</label>
        <select name="school_class" id="school_class" class="form-select" required>
          <option value="">Select Class</option>
          {% for r in registrations %}
          <option value="{{ r.school_class.id }}"
            {% if selected_class and selected_class.id == r.school_class.id %}selected{% endif %}>
            {{ r.school_class.name }}
          </option>
          {% endfor %}
        </select>
      </div>

      <div class="col-md-4">
        <label for="subject">Subject</label>
        <select name="subject" id="subject" class="form-select" required>
          <option value="">Select Subject</option>
          {% for r in registrations %}
          <option value="{{ r.subject.id }}"
            {% if selected_subject and selected_subject.id == r.subject.id %}selected{% endif %}>
            {{ r.subject.name }}
          </option>
          {% endfor %}
        </select>
      </div>

      <div class="col-md-4">
        <label for="semester">Semester</label>
        <select name="semester" id="semester" class="form-select" required>
          <option value="">Select Semester</option>
          {% for sem in semesters %}
          <option value="{{ sem.id }}"
            {% if selected_semester and selected_semester.id == sem.id %}selected{% endif %}>
            {{ sem.name }}
          </option>
          {% endfor %}
        </select>
      </div>
    </div>
    <button class="btn btn-primary">Load Students</button>
  </form>

  <!-- Step 2: Show Students + Marks -->
  {% if students %}
  <form method="post">{% csrf_token %}
    <input type="hidden" name="school_class" value="{{ selected_class.id }}">
    <input type="hidden" name="subject" value="{{ selected_subject.id }}">
    <input type="hidden" name="semester" value="{{ selected_semester.id }}">
    <input type="hidden" name="save_marks" value="1">

    <h5>Students in {{ selected_class.name }} - {{ selected_subject.name }} ({{ selected_semester.name }})</h5>
    <table class="table table-striped mt-3">
      <thead>
        <tr>
          <th>Student</th>
          <th>Marks</th>
        </tr>
      </thead>
      <tbody>
        {% for student in students %}
        <tr>
          <td>{{ student.first_name }} {{ student.last_name }}</td>
          <td>
            <input type="number" name="marks_{{ student.id }}" class="form-control" min="0" max="100">
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <button class="btn btn-success">Save Marks</button>
  </form>
  {% endif %}
</div>
{% endblock %}
